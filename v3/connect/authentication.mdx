---
title: Authentication
description: 'Authenticate users and manage permissions with Handcash Connect'
---

# HandCash Authentication Integration Guide

## Critical: Key Generation Code

Required dependency:
```json
"@noble/secp256k1": "2.2.3"
```

Exact code (use anywhere - client or server):
```typescript
import * as secp256k1 from "@noble/secp256k1"

export function generateAuthenticationKeyPair() {
  const privateKey = secp256k1.utils.randomSecretKey()
  const publicKey = secp256k1.getPublicKey(privateKey, true)
  
  return {
    privateKey: Buffer.from(privateKey).toString("hex"),
    publicKey: Buffer.from(publicKey).toString("hex"),
  }
}
```

## Authentication Flow

### 1. Generate keys

```typescript
const { privateKey, publicKey } = generateAuthenticationKeyPair()
```

### 2. Store privateKey somewhere

**Client:**
- localStorage
- sessionStorage
- memory

**Server:**
- database
- Redis
- session
- JWT

### 3. Redirect to HandCash

```typescript
const authUrl = `https://handcash.io/connect?appId=YOUR_APP_ID&publicKey=${publicKey}`
window.location.href = authUrl
```

### 4. On callback, validate authToken

```typescript
import { getInstance, Connect } from '@handcash/sdk'

// privateKey IS the authToken
const authToken = privateKey

// Validate with HandCash
const sdk = getInstance({ appId, appSecret })
const client = sdk.getAccountClient(authToken)
await Connect.getCurrentUserProfile({ client })
```

### 5. Store authToken for user session

Store the `authToken` (which is the `privateKey`) securely for the user's session.

## That's It

The `privateKey` becomes the `authToken`. Generate it, send `publicKey` to HandCash, validate the `privateKey`/`authToken`, store it for the session.

## Check User Permissions

```typescript
const { data } = await Connect.getPermissions({ client })
console.log('User granted permissions:', data?.items)
```

## Error Handling

```typescript
try {
  const client = sdk.getAccountClient(authToken)
  const profile = await Connect.getCurrentUserProfile({ client })
} catch (error) {
  if (error.message.includes('Invalid token')) {
    // Token expired or invalid, redirect to re-authenticate
    const { publicKey } = generateAuthenticationKeyPair()
    window.location.href = `https://handcash.io/connect?appId=${appId}&publicKey=${publicKey}`
  }
}
```

## Security Best Practices

- **Store tokens securely** - Use encrypted storage or secure sessions
- **Use HTTPS** - Always use HTTPS for redirect URLs
- **Validate tokens** - Check token validity before making API calls
- **Protect the privateKey** - The privateKey IS the authToken - treat it as sensitive data
